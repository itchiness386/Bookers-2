<% if flash[:success] %>
	<p><%= flash[:success] %></p>
<% end %>

<div class="row">
	<div class="col-xs-3">

	<%= render  'users/userinfo' %>

	<%= render 'newbook', book: @newbook %>

	</div>

	<div class="col-xs-9">
		<h2>Book detail</h2>
		<table class="table">
			<tbody>
				<tr>
					<td>
						<%= link_to user_path(@user.id) do %>
							<%= attachment_image_tag  @user, :profile_image, :fill, 40, 40, format: 'jpeg', class: "attachment user profile_image fallback", fallback: "no_image.jpg", size:'40x40' %>
							<br>
							<%= @user.name %>
						<% end %>
					</td>
					<td>
						<%= link_to @book.title, book_path(@book.id) %>
					</td>
					<td>
						<%= @book.body %>
					</td>
					<% if @book.favorited_by?(current_user) %>
					  <td>
					    <%= link_to book_favorites_path(@book), method: :delete do %>
					      <i class="fa fa-heart" aria-hidden="true" style="color: red;"></i>
					      <%= @book.favorites.count %>
					    <% end %>
					  </td>
					<% else %>
					  <td>
					    <%= link_to book_favorites_path(@book), method: :post do %>
					      <i class="fa fa-heart-o" aria-hidden="true"></i>
					      <%= @book.favorites.count %>
					    <% end %>
					  </td>
					<% end %>
					<td>
						コメント数:<%= @book.book_comments.count %>
					</td>
					<% if @user == current_user %>
						<td>
							<%= link_to 'Edit', edit_book_path(@book.id), class: "btn-sm btn-success edit_book_#{@book.id}" %>
						</td>
						<td>
							<%= link_to 'Destroy', book_path(@book.id), method: :delete, "data-confirm" => "本当に消しますか？", class: "btn-sm btn-danger destroy_book_#{@book.id}" %>
						</td>
					<% end %>
				</tr>
			</tbody>
		</table>

		<h2>Comments</h2>
		<table class="table">
			<% @book.book_comments.each do |book_comment| %>
				<tr>
					<td class="col-xs-2">
						<%= link_to user_path(book_comment.user) do %>
							<%= attachment_image_tag  book_comment.user, :profile_image, :fill, 40, 40, format: 'jpeg', class: "attachment user profile_image fallback", fallback: "no_image.jpg", size:'40x40' %>
							<br>
							<%= book_comment.user.name %>
						<% end %>
					</td>
			        <td class="col-xs-2"><%= book_comment.created_at.strftime('%Y/%m/%d') %></td>
			        <td class="col-xs-6"><%= book_comment.comment %></td>
					<td class="col-xs-2">
				        <% if book_comment.user == current_user %>
							<%= link_to 'Destroy', book_book_comments_path(book_comment.book.id), method: :delete, "data-confirm" => "本当に消しますか？", class: "btn-sm btn-danger destroy_book_#{book_comment.book.id}" %>
						<% end %>
					</td>
				</tr>
			<% end %>
		</table>

		<%= form_for [@book, @book_comment] do |f| %>
		    <div class="row">
		        <div class="col-sm-11">
		            <%= f.text_area :comment, rows:'5', class: "form-control" %>
		        </div>
			    <%= f.submit "送信", class: "btn btn-primary d-flex align-items-end" %>
		    </div>
		<% end %>

	</div>
</div>